var e,o;"function"==typeof(e=globalThis.define)&&(o=e,e=null),function(o,t,n,r,a){var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},c="function"==typeof i[r]&&i[r],s=c.cache||{},l="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function d(e,t){if(!s[e]){if(!o[e]){var n="function"==typeof i[r]&&i[r];if(!t&&n)return n(e,!0);if(c)return c(e,!0);if(l&&"string"==typeof e)return l(e);var a=Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}f.resolve=function(t){var n=o[e][1][t];return null!=n?n:t},f.cache={};var u=s[e]=new d.Module(e);o[e][0].call(u.exports,f,u,u.exports,this)}return s[e].exports;function f(e){var o=f.resolve(e);return!1===o?{}:d(o)}}d.isParcelRequire=!0,d.Module=function(e){this.id=e,this.bundle=d,this.exports={}},d.modules=o,d.cache=s,d.parent=c,d.register=function(e,t){o[e]=[function(e,o){o.exports=t},{}]},Object.defineProperty(d,"root",{get:function(){return i[r]}}),i[r]=d;for(var u=0;u<t.length;u++)d(t[u]);if(n){var f=d(n);"object"==typeof exports&&"undefined"!=typeof module?module.exports=f:"function"==typeof e&&e.amd?e(function(){return f}):a&&(this[a]=f)}}({kgW6q:[function(e,o,t){e("../../../background")},{"../../../background":"8VaxY"}],"8VaxY":[function(e,o,t){async function n(e){try{let o=function(e){try{let o=new URL(e),t=o.pathname,n=t.split("/").pop()||"";if(n&&/\.(jpg|jpeg|png|gif|webp|svg|bmp|ico)$/i.test(n)){let e=n.split("?")[0];return e.replace(/[<>:"/\\|?*]/g,"_")}}catch(e){console.error("Failed to parse URL:",e)}let o=Date.now(),t=function(e){let o=e.match(/\.(jpg|jpeg|png|gif|webp|svg|bmp|ico)(\?.*)?$/i);return o?o[1].toLowerCase():"jpg"}(e);return`PickPic_${o}.${t}`}(e);await chrome.downloads.download({url:e,filename:`PickPic/${o}`,saveAs:!1}),console.log("Image downloaded successfully:",o)}catch(e){console.error("Failed to download image:",e)}}async function r(e,o){if(!e){o({error:"No active tab"});return}try{let t=await chrome.tabs.sendMessage(e,{type:"EXTRACT_CONTENT"});o(t)}catch(e){o({error:e instanceof Error?e.message:"Failed to extract content"})}}async function a(e,o){if(!e){o({error:"No active tab"});return}try{let t=await chrome.tabs.sendMessage(e,{type:"EXTRACT_CONTENT"});o(t)}catch(e){o({error:e instanceof Error?e.message:"Failed to refresh data"})}}async function i(e,o){try{let{images:t,articleTitle:n}=e;if(!t||0===t.length){o({error:"No images to download"});return}for(let e of t){let o=`wechat-pic/${n}/${e.alt}.jpg`;await chrome.downloads.download({url:e.src,filename:o,saveAs:!1})}o({success:!0})}catch(e){o({error:e instanceof Error?e.message:"Failed to download images"})}}e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(t),chrome.runtime.onInstalled.addListener(()=>{chrome.contextMenus.create({id:"download-image",title:"\u4e0b\u8f7d\u6b64\u56fe\u7247 / Download this image",contexts:["image"]})}),chrome.contextMenus.onClicked.addListener((e,o)=>{"download-image"===e.menuItemId&&e.srcUrl&&n(e.srcUrl)}),chrome.action.onClicked.addListener(async e=>{e.windowId&&await chrome.sidePanel.open({windowId:e.windowId})}),chrome.runtime.onMessage.addListener((e,o,t)=>{switch(e.type){case"EXTRACT_CONTENT":r(o.tab?.id,t);break;case"REFRESH_DATA":a(o.tab?.id,t);break;case"DOWNLOAD_IMAGES":i(e.data,t);break;default:t({error:"Unknown message type"})}return!0}),console.log("PickPic background service worker loaded")},{"@parcel/transformer-js/src/esmodule-helpers.js":"hbR2Q"}],hbR2Q:[function(e,o,t){t.interopDefault=function(e){return e&&e.__esModule?e:{default:e}},t.defineInteropFlag=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.exportAll=function(e,o){return Object.keys(e).forEach(function(t){"default"===t||"__esModule"===t||o.hasOwnProperty(t)||Object.defineProperty(o,t,{enumerable:!0,get:function(){return e[t]}})}),o},t.export=function(e,o,t){Object.defineProperty(e,o,{enumerable:!0,get:t})}},{}]},["kgW6q"],"kgW6q","parcelRequire7587"),globalThis.define=o;